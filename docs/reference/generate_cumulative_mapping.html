<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Generate Cumulative Mapping — generate_cumulative_mapping • orgsurveyr</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Generate Cumulative Mapping — generate_cumulative_mapping" />

<meta property="og:description" content="Takes an organisation as a tbl_graph object and a data frame that maps individuals to units
and returns a data frame that maps an organisational unit to all individuals within that unit." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">orgsurveyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/introduction_to_orgsurveyr.html">Introduction To orgsurveyr</a>
    </li>
    <li>
      <a href="../articles/organisations_with_ggraph.html">Simulating Organisations With tidygraph and ggraph</a>
    </li>
    <li>
      <a href="../articles/package_setup.html">Setting Up The orgsurveyr Package</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ukgovdatascience/orgsurveyr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generate Cumulative Mapping</h1>
    <small class="dont-index">Source: <a href='https://github.com/ukgovdatascience/orgsurveyr/blob/master/R/generate_cumulative_mapping_df.R'><code>R/generate_cumulative_mapping_df.R</code></a></small>
    <div class="hidden name"><code>generate_cumulative_mapping.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Takes an organisation as a tbl_graph object and a data frame that maps individuals to units
and returns a data frame that maps an organisational unit to all individuals within that unit.</p>
    
    </div>

    <pre class="usage"><span class='fu'>generate_cumulative_mapping</span>(<span class='no'>tg</span>, <span class='no'>df</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>tg</th>
      <td><p>tbl_graph that passes a check with check_tbl_graph_is_org</p></td>
    </tr>
    <tr>
      <th>df</th>
      <td><p>a data frame with columns named unit_id and invididual_id - see see the indiv_df format
in <code><a href='orgsurveyr-data-formats.html'>orgsurveyr-data-formats</a></code></p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>tbl_df</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For example, if an organisation is split into four departments, and each department has four teams,
an employee is affiliated not just to their immediate team, but also their department and the organisation
as a whole.</p>
<p>The output dataframe serves as a basis for calculating unit level summaries that include all individuals
affiliated to that unit.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>dplyr</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Random'>set.seed</a></span>(<span class='fl'>1234</span>)
<span class='no'>tg_ex1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='create_realistic_org.html'>create_realistic_org</a></span>(<span class='kw'>n_children</span> <span class='kw'>=</span> <span class='fl'>4</span>, <span class='kw'>max_depth</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>prob</span><span class='kw'>=</span><span class='fl'>0.3</span>)
<span class='no'>tg_ex1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='simulate_unit_size.html'>simulate_unit_size</a></span>(<span class='no'>tg_ex1</span>)
<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='simulate_individuals_df.html'>simulate_individuals_df</a></span>(<span class='no'>tg_ex1</span>)

<span class='no'>map_df</span> <span class='kw'>&lt;-</span> <span class='fu'>generate_cumulative_mapping</span>(<span class='no'>tg_ex1</span>, <span class='no'>df</span>)
<span class='no'>map_df</span></div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 552 x 2</span><span>
#&gt;    parent_id individual_id
#&gt;    </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>        
#&gt; </span><span style='color: #555555;'> 1</span><span> 1         1            
#&gt; </span><span style='color: #555555;'> 2</span><span> 1         2            
#&gt; </span><span style='color: #555555;'> 3</span><span> 1         3            
#&gt; </span><span style='color: #555555;'> 4</span><span> 1         4            
#&gt; </span><span style='color: #555555;'> 5</span><span> 1         5            
#&gt; </span><span style='color: #555555;'> 6</span><span> 1         6            
#&gt; </span><span style='color: #555555;'> 7</span><span> 1         7            
#&gt; </span><span style='color: #555555;'> 8</span><span> 1         8            
#&gt; </span><span style='color: #555555;'> 9</span><span> 1         9            
#&gt; </span><span style='color: #555555;'>10</span><span> 1         10           
#&gt; </span><span style='color: #555555;'># ... with 542 more rows</span><span></div><div class='input'>
<span class='co'>#use the map to calculate cumulative means</span>
<span class='no'>df</span> <span class='kw'>%&gt;%</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/dplyr/topics/join'>inner_join</a></span>(<span class='no'>map_df</span>, <span class='kw'>by</span><span class='kw'>=</span><span class='st'>'individual_id'</span>) <span class='kw'>%&gt;%</span>
 <span class='fu'><a href='https://www.rdocumentation.org/packages/dplyr/topics/group_by'>group_by</a></span>(<span class='no'>parent_id</span>) <span class='kw'>%&gt;%</span>
 <span class='fu'><a href='https://www.rdocumentation.org/packages/dplyr/topics/summarise'>summarise</a></span>(<span class='kw'>cum_test_var</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/mean'>mean</a></span>(<span class='no'>test_var</span>),
           <span class='kw'>cum_n</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/dplyr/topics/n'>n</a></span>())</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 42 x 3</span><span>
#&gt;    parent_id cum_test_var cum_n
#&gt;    </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 1</span><span> 1                10.2    146
#&gt; </span><span style='color: #555555;'> 2</span><span> 10                9.80    10
#&gt; </span><span style='color: #555555;'> 3</span><span> 11               10.7     20
#&gt; </span><span style='color: #555555;'> 4</span><span> 12                9.95    21
#&gt; </span><span style='color: #555555;'> 5</span><span> 13                9.24    12
#&gt; </span><span style='color: #555555;'> 6</span><span> 15               12.0      6
#&gt; </span><span style='color: #555555;'> 7</span><span> 17               10.6     13
#&gt; </span><span style='color: #555555;'> 8</span><span> 2                10.2     59
#&gt; </span><span style='color: #555555;'> 9</span><span> 22               11.1      5
#&gt; </span><span style='color: #555555;'>10</span><span> 23                9.58     5
#&gt; </span><span style='color: #555555;'># ... with 32 more rows</span><span></div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Phil Chapman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.9000.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

