<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analysing People Survey Data With The orgsurveyr Package • orgsurveyr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Analysing People Survey Data With The orgsurveyr Package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">orgsurveyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/analysing_people_survey_data.html">Analysing People Survey Data With The orgsurveyr Package</a>
    </li>
    <li>
      <a href="../articles/introduction_to_orgsurveyr.html">Introduction To orgsurveyr</a>
    </li>
    <li>
      <a href="../articles/organisations_with_ggraph.html">Simulating Organisations With tidygraph and ggraph</a>
    </li>
    <li>
      <a href="../articles/package_setup.html">Setting Up The orgsurveyr Package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ukgovdatascience/orgsurveyr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Analysing People Survey Data With The orgsurveyr Package</h1>
                        <h4 class="author">Phil Chapman</h4>
            
            <h4 class="date">2018-11-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ukgovdatascience/orgsurveyr/blob/master/../vignettes/analysing_people_survey_data.Rmd"><code>../vignettes/analysing_people_survey_data.Rmd</code></a></small>
      <div class="hidden name"><code>analysing_people_survey_data.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette describes how the <code>orgsurveyr</code> package can be used to analyse data from the UK Civil Service People Survey. Note that because the People Survey data for government departments is not in the public domain, it is not possible to provide a fully reproducible analysis. However, the code included here was used to analyse real data and can be used to understand the analysis as a general recipe.</p>
</div>
<div id="loading-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#loading-the-data" class="anchor"></a>Loading the data</h1>
<div id="raw-data-files" class="section level2">
<h2 class="hasAnchor">
<a href="#raw-data-files" class="anchor"></a>Raw data files</h2>
<p>The following data files are the start point for the people survey. In this example, data for the <a href="https://www.youtube.com/watch?v=iV2ViNJFZC8">Ministry of Silly Walks</a> is provided:</p>
<div id="org2017_msw-sav" class="section level3">
<h3 class="hasAnchor">
<a href="#org2017_msw-sav" class="anchor"></a><code>org2017_MSW.sav</code>
</h3>
<p>An SPSS file containing the individual level responses for questions and combined variables. This file has one row per individual and one column per variable.</p>
</div>
<div id="org2017_msw_hierarchy-sav" class="section level3">
<h3 class="hasAnchor">
<a href="#org2017_msw_hierarchy-sav" class="anchor"></a><code>org2017_MSW_hierarchy.sav</code>
</h3>
<p>As SPSS file containing one row per organisational unit that an individual is a member of. For example, all individuals will have an entry for MSW0000 which is the department code for the Ministry of Silly Walks. If this Ministry has an HR department, and a recruiting team within that, then an individual within this team would have 3 rows in this file:</p>
<pre><code>#&gt; # A tibble: 3 x 5
#&gt;   ResponseID DeptCode OUCode Returns Population
#&gt;        &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1     123456 MSW0000       4    1234       1345
#&gt; 2     123456 MSW1234       4     123        123
#&gt; 3     123456 MSW1235       4      12         13</code></pre>
</div>
<div id="hierarchy-survey-xlsx" class="section level3">
<h3 class="hasAnchor">
<a href="#hierarchy-survey-xlsx" class="anchor"></a><code>Hierarchy Survey.xlsx</code>
</h3>
<p>An MS Excel file containing information about the organisational units within the department, with one row per organisational unit. Taking the Ministry of Silly Walks as our example, it might look like this:</p>
<pre><code>#&gt; # A tibble: 3 x 4
#&gt;   DeptCode  Tier Parent  UnitName               
#&gt;   &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;                  
#&gt; 1 MSW0000      2 MSW     Ministry of Silly Walks
#&gt; 2 MSW1234      3 MSW0000 MSW Human Resources    
#&gt; 3 MSW1235      4 MSW1234 MSW HR Recruiting Team</code></pre>
<p>The key information in this file is the link between a department and its parent since this lets us represent the Ministry as a network.</p>
</div>
<div id="core_comments_report_2017_msw0000_with_ids-xls" class="section level3">
<h3 class="hasAnchor">
<a href="#core_comments_report_2017_msw0000_with_ids-xls" class="anchor"></a><code>Core_Comments_Report_2017_MSW0000_with_IDs.xls</code>
</h3>
<p>An MS Excel file with one row per individual, and with each column representing a different free text field from the Survey.</p>
</div>
</div>
<div id="data-import" class="section level2">
<h2 class="hasAnchor">
<a href="#data-import" class="anchor"></a>Data import</h2>
<p>Data can be imported using the <code>haven</code> and <code>readxl</code> R packages. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datapath &lt;-<span class="st"> 'path/to/files'</span>
df_survey &lt;-<span class="st"> </span>haven<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/haven/topics/read_spss">read_sav</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(datapath, <span class="st">'org2017_MSW.sav'</span>))
df_depts &lt;-<span class="st"> </span>readxl<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(datapath, <span class="st">'Hierarchy Survey.xlsx'</span>), 
                               <span class="dt">col_names =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'DeptCode'</span>, <span class="st">'Tier'</span>, <span class="st">'Parent'</span>, <span class="st">'UnitName'</span>), <span class="dt">skip =</span> <span class="dv">1</span>)</code></pre></div>
</div>
<div id="data-cleaning" class="section level2">
<h2 class="hasAnchor">
<a href="#data-cleaning" class="anchor"></a>Data cleaning</h2>
<p>It is worth explicitly typing the imported data to avoid problems further along the line, especially from SPSS files:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_org &lt;-<span class="st"> </span>df_org <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(OUCode, Returns, Population), as.integer) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(ResponseID, DeptCode), as.character)

df_depts &lt;-<span class="st"> </span>df_depts <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Tier), as.integer) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="op">-</span>Tier), as.character)</code></pre></div>
</div>
</div>
<div id="data-preparation" class="section level1">
<h1 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h1>
<div id="introduction-1" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-1" class="anchor"></a>Introduction</h2>
<p>Now that the data has been loaded into R, the next step is to reformat it into one of the data formats required by the <code>orgsurveyr</code> package. This can be accomplished using a fairly standard ‘tidyverse’ workflow. To read more about the tidyverse suite of R packages the <a href="https://www.tidyverse.org">tidyverse website</a> is very useful. There are also a number of DataCamp courses (some of which are free) which are worth following to get quickly up to speed, for example <a href="https://www.datacamp.com/courses/introduction-to-the-tidyverse">Introduction to the Tidyverse</a>.</p>
<p>To read more about the data formats used in the <code>orgsurveyr</code> package see <a href="../html/orgsurveyr-data-formats.html">orgsurveyr-data-formats</a>.</p>
</div>
<div id="individual-responses-data" class="section level2">
<h2 class="hasAnchor">
<a href="#individual-responses-data" class="anchor"></a>Individual responses data</h2>
<p>First define the numeric values in the survey that we are interested in:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">metric_colnames &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'ees'</span>, <span class="st">'mw_p'</span>, <span class="st">'op_p'</span>, <span class="st">'lm_p'</span>, <span class="st">'mt_p'</span>,
                     <span class="st">'ld_p'</span>, <span class="st">'if_p'</span>, <span class="st">'rw_p'</span>, <span class="st">'pb_p'</span>, <span class="st">'lc_p'</span>,
                     <span class="st">'eef'</span>, <span class="st">'f1_mw'</span>, <span class="st">'f2_op'</span>)</code></pre></div>
<p>Next we select just these columns from the survey data, make them numeric, and un-pivot using the <code><a href="https://www.rdocumentation.org/packages/tidyr/topics/gather">tidyr::gather</a></code> function to make a long/skinny dataframe with one row per metric/individual combination.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_metrics &lt;-<span class="st"> </span>df_survey <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(ResponseID, metric_colnames) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/summarise_all">mutate_at</a></span>(<span class="kw">vars</span>(metric_colnames), as.numeric) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/summarise_all">mutate_at</a></span>(<span class="kw">vars</span>(ResponseID), as.character) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/select">rename</a></span>(<span class="dt">individual_id =</span> ResponseID) <span class="op">%&gt;%</span>
<span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tidyr/topics/gather">gather</a></span>( <span class="st">'metric_id'</span>, <span class="st">'value'</span>, <span class="op">-</span>individual_id) </code></pre></div>
<p>This is the <code>indiv_tall_df</code> format that the <code>orgsurveyr</code> package requires. It is an example of a tidy data frame since each row represents one observation per individual/metric combination. It is extensible no matter how many individuals or metrics are considered since there are only three columns. The example data for this format is below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tg_org_indiv_tall_df
<span class="co">#&gt; # A tibble: 292 x 3</span>
<span class="co">#&gt;    individual_id metric_id value</span>
<span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1             test_var   7.27</span>
<span class="co">#&gt;  2 2             test_var   8.53</span>
<span class="co">#&gt;  3 3             test_var   9.21</span>
<span class="co">#&gt;  4 4             test_var  12.9 </span>
<span class="co">#&gt;  5 5             test_var   5.02</span>
<span class="co">#&gt;  6 6             test_var  11.0 </span>
<span class="co">#&gt;  7 7             test_var   6.33</span>
<span class="co">#&gt;  8 8             test_var  13.8 </span>
<span class="co">#&gt;  9 9             test_var   7.48</span>
<span class="co">#&gt; 10 10            test_var  11.7 </span>
<span class="co">#&gt; # ... with 282 more rows</span></code></pre></div>
<p>We can also use the <code>get_df_format</code> function to confirm this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/get_df_format.html">get_df_format</a></span>(tg_org_indiv_tall_df)
<span class="kw"><a href="../reference/get_df_format.html">get_df_format</a></span>(df_metrics)</code></pre></div>
</div>
<div id="mapping-individual-to-organisational-unit" class="section level2">
<h2 class="hasAnchor">
<a href="#mapping-individual-to-organisational-unit" class="anchor"></a>Mapping individual to organisational unit</h2>
<p>In this section we want to generate an individual to organisational unit mapping data frame. The data format is very simple, and is represented in the example below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tg_org_indiv_minimal_df
<span class="co">#&gt; # A tibble: 146 x 2</span>
<span class="co">#&gt;    individual_id unit_id</span>
<span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;  </span>
<span class="co">#&gt;  1 1             1      </span>
<span class="co">#&gt;  2 2             1      </span>
<span class="co">#&gt;  3 3             1      </span>
<span class="co">#&gt;  4 4             3      </span>
<span class="co">#&gt;  5 5             3      </span>
<span class="co">#&gt;  6 6             4      </span>
<span class="co">#&gt;  7 7             4      </span>
<span class="co">#&gt;  8 8             4      </span>
<span class="co">#&gt;  9 9             5      </span>
<span class="co">#&gt; 10 10            5      </span>
<span class="co">#&gt; # ... with 136 more rows</span></code></pre></div>
<p>This is the <code>indiv_df</code> format that the <code>orgsurveyr</code> package requires where each individual is represented by a single row in the data frame. However, the People Survey data doesn’t come in this form directly so we have to convert it, this is done below.</p>
<p>First we join the organisational unit level information in <code>df_depts</code> with the individual to organisational unit mapping in<code>df_org</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_org_depts &lt;-<span class="st"> </span>df_org <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(ResponseID, DeptCode) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/join">inner_join</a></span>(df_depts, <span class="st">'DeptCode'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(<span class="op">-</span>UnitName) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/arrange">arrange</a></span>(ResponseID, <span class="kw">desc</span>(Tier))</code></pre></div>
<p>This lists all organisational units in the heirarchy which an individual is a member of. So next we order by Tier and select the highest value - ie the deepest level in the organisation to which the individual is associated. This can be regarded as the individual’s parent organisational unit.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_indiv_dept &lt;-<span class="st"> </span>df_org_depts <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/group_by">group_by</a></span>(ResponseID) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/mutate">mutate</a></span>(<span class="dt">Tier_zero_indexed =</span> dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/ranking">row_number</a></span>(<span class="kw">desc</span>(Tier))) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/group_by">ungroup</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/filter">filter</a></span>(Tier_zero_indexed <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/mutate">transmute</a></span>(<span class="dt">individual_id=</span>ResponseID, <span class="dt">unit_id=</span>DeptCode)</code></pre></div>
<p>We can use the <code>get_df_format</code> function to confirm that the data is in the correct format:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/get_df_format.html">get_df_format</a></span>(tg_org_indiv_minimal_df)
<span class="kw"><a href="../reference/get_df_format.html">get_df_format</a></span>(df_indiv_dept)</code></pre></div>
</div>
<div id="organisational-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#organisational-structure" class="anchor"></a>Organisational structure</h2>
<p>The organisation is represented as a network, and the data object is a <code>tbl_graph</code> from the <a href="https://CRAN.R-project.org/package=tidygraph"><code>tidygraph</code></a> package. This can be created from two data frames, one representing the nodes (organisational units) and the other representing the edges (line management relationship of each organisational unit). Firstly, to create the nodes data frame we slightly modify the <code>df_depts</code> data frame by adding a <code>unit_id</code> column and <code>name</code> column which are required for later operations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nodes_depts &lt;-<span class="st"> </span>df_depts <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">name=</span>DeptCode, <span class="dt">unit_id=</span>DeptCode, DeptCode, Parent, Tier, UnitName,
            <span class="dt">DisplayName=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(DeptCode, <span class="st">': '</span>, UnitName))</code></pre></div>
<p>Next we can adapt this to make the nodes data frame by removing the root node and changing the column names to <code>to</code> and <code>from</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">edges_depts &lt;-<span class="st"> </span>nodes_depts <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/filter">filter</a></span>(DeptCode <span class="op">!=</span><span class="st"> 'MSW0000'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">from=</span>Parent,<span class="dt">to=</span>DeptCode)
edges_depts</code></pre></div>
<p>Now these two data frames can be combined and converted into a <code>tbl_graph</code> object using the <code><a href="https://www.rdocumentation.org/packages/igraph/topics/graph_from_data_frame">igraph::graph_from_data_frame</a></code> and <code><a href="https://www.rdocumentation.org/packages/tidygraph/topics/tbl_graph">tidygraph::as_tbl_graph</a></code> functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_org &lt;-<span class="st"> </span>igraph<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/igraph/topics/graph_from_data_frame">graph_from_data_frame</a></span>(
  edges_depts,
  <span class="dt">directed=</span><span class="ot">TRUE</span>,
  <span class="dt">vertices=</span>nodes_depts) <span class="op">%&gt;%</span>
<span class="st">  </span>tidygraph<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tidygraph/topics/tbl_graph">as_tbl_graph</a></span>()
tidy_org</code></pre></div>
<p>Finally check that the <code>tbl_graph</code> object has been created correctly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/check_tbl_graph_is_org.html">check_tbl_graph_is_org</a></span>(tidy_org)</code></pre></div>
</div>
</div>
<div id="data-exploration-with-orgsurveyr" class="section level1">
<h1 class="hasAnchor">
<a href="#data-exploration-with-orgsurveyr" class="anchor"></a>Data Exploration With orgsurveyr</h1>
<div id="generate-summary-data" class="section level2">
<h2 class="hasAnchor">
<a href="#generate-summary-data" class="anchor"></a>Generate summary data</h2>
<p>With the data in the correct format, we can use the <code>calc_summary_function</code> to calculate organisational unit level summaries for the People Survey data. Below we do this for <code>ees</code> - the Employee Engagement Score:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">org_summary_ees &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc_summary_df.html">calc_summary_df</a></span>(tidy_org, <span class="dt">df=</span>df_indiv_dept, <span class="dt">tall_df=</span>df_metrics, <span class="dt">selected_vars =</span> <span class="st">'ees'</span>, <span class="dt">is_cumulative =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>This output data frame is in the <code>org_tall_df</code> format which has one row per organisational unit/metric combination:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tg_org_summarised_df
<span class="co">#&gt; # A tibble: 76 x 3</span>
<span class="co">#&gt;    unit_id metric_id value</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1       test_var   10.2</span>
<span class="co">#&gt;  2 1       test_var2  20.2</span>
<span class="co">#&gt;  3 10      test_var   10.9</span>
<span class="co">#&gt;  4 10      test_var2  20.2</span>
<span class="co">#&gt;  5 11      test_var   10.4</span>
<span class="co">#&gt;  6 11      test_var2  20.8</span>
<span class="co">#&gt;  7 13      test_var   11.0</span>
<span class="co">#&gt;  8 13      test_var2  19.6</span>
<span class="co">#&gt;  9 14      test_var   10.2</span>
<span class="co">#&gt; 10 14      test_var2  21.1</span>
<span class="co">#&gt; # ... with 66 more rows</span></code></pre></div>
<p>Here we have generated cumulative metrics - ie where individuals from all organisation units in the current one and its children are included. To generate non-cumulative metrics the <code>is_cumulative</code> parameter can be set to <code>FALSE</code>.</p>
<p>It is also possible to calculate all metrics at once as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">org_summary_all &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc_summary_df.html">calc_summary_df</a></span>(tidy_org, <span class="dt">df=</span>df_indiv_dept, <span class="dt">tall_df=</span>df_metrics, <span class="dt">selected_vars =</span> metric_colnames, <span class="dt">is_cumulative =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="explore-summary-data" class="section level2">
<h2 class="hasAnchor">
<a href="#explore-summary-data" class="anchor"></a>Explore summary data</h2>
<p>To find the organisational units with the highest engagement scores:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">org_summary_all <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/filter">filter</a></span>(metric_id <span class="op">==</span><span class="st"> 'ees'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/arrange">arrange</a></span>(<span class="kw">desc</span>(value)) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/top_n">top_n</a></span>(<span class="dt">n =</span> <span class="dv">10</span>)</code></pre></div>
</div>
<div id="visualise-summary-scores" class="section level2">
<h2 class="hasAnchor">
<a href="#visualise-summary-scores" class="anchor"></a>Visualise summary scores</h2>
<p>The entire organisation can be visualised as a starburst plot as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_org.html">plot_org</a></span>(tidy_org, <span class="dt">fill=</span><span class="st">'ees'</span>, <span class="dt">df=</span>org_summary_all, <span class="dt">is_circular =</span> <span class="ot">TRUE</span>, <span class="dt">is_dendrogram =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colours=</span>RColorBrewer<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/RColorBrewer/topics/ColorBrewer">brewer.pal</a></span>(<span class="dv">11</span>, <span class="st">'PiYG'</span>))</code></pre></div>
</div>
<div id="interactive-visualisation-of-summary-scores" class="section level2">
<h2 class="hasAnchor">
<a href="#interactive-visualisation-of-summary-scores" class="anchor"></a>Interactive visualisation of summary scores</h2>
<p>To generate an interactive visualisation call the <code>orgviz</code> function to launch a shiny app:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/orgviz.html">orgviz</a></span>(<span class="dt">tg=</span>tidy_org, <span class="dt">df=</span>org_summary_all)</code></pre></div>
</div>
</div>
<div id="natural-language-processing" class="section level1">
<h1 class="hasAnchor">
<a href="#natural-language-processing" class="anchor"></a>Natural Language Processing</h1>
<div id="introduction-2" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-2" class="anchor"></a>Introduction</h2>
<p>In addition to numeric survey responses, the People Survey also includes free text. This can be analysed in a number of different ways to turn it into numeric data which can then be analysed in <code>orgsurveyr</code>. The simplest analysis would be to calculate the term or bigram frequency for terms of interest, but here Topic Modelling using the <a href="http://structuraltopicmodel.com"><code>stm</code></a> package is exemplified as a way to extract useful insight from text data. The approach was inspired by <a href="https://juliasilge.com/blog/sherlock-holmes-stm/">this blog by Julia Silge</a> and her excellent book: <a href="https://www.tidytextmining.com">Text Mining With R, A Tidy Approach</a>.</p>
</div>
<div id="prepare-data-for-nlp" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-data-for-nlp" class="anchor"></a>Prepare data for NLP</h2>
<div id="clean-data" class="section level3">
<h3 class="hasAnchor">
<a href="#clean-data" class="anchor"></a>Clean data</h3>
<p>Make sure that field names are correct:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">comments &lt;-<span class="st"> </span>comments_core <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/mutate">transmute</a></span>(<span class="dt">ResponseID=</span><span class="st">`</span><span class="dt">Response ID</span><span class="st">`</span>, Comment)</code></pre></div>
</div>
<div id="tokenise-and-remove-stopwords" class="section level3">
<h3 class="hasAnchor">
<a href="#tokenise-and-remove-stopwords" class="anchor"></a>Tokenise and remove stopwords</h3>
<p>Tidy the comments using the tidytext ‘bag of words’ approach by tokenising and then removing stopwords with an anti-join.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_comments &lt;-<span class="st"> </span>comments <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_tokens</span>(sentence, Comment, <span class="dt">token=</span><span class="st">'sentences'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sid=</span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/ranking">row_number</a></span>(ResponseID)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest_tokens</span>(word, sentence) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(stop_words)</code></pre></div>
</div>
<div id="examine-the-number-of-words-extracted" class="section level3">
<h3 class="hasAnchor">
<a href="#examine-the-number-of-words-extracted" class="anchor"></a>Examine the number of words extracted</h3>
<p>We can count the number of words present following tokenisation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_comments <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(word, <span class="dt">sort=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>Then extract the top 1000 most common words to be used in the analysis:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">common_words &lt;-<span class="st"> </span>tidy_comments <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(word, <span class="dt">sort=</span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">top_n</span>(<span class="dv">1000</span>, n) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(<span class="op">-</span>n)</code></pre></div>
</div>
<div id="create-a-document-frequency-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#create-a-document-frequency-matrix" class="anchor"></a>Create a document frequency matrix</h3>
<p>The tidy comments data frame can be converted into document frequency matrix using the <code>tidytext::cast_dfm</code> function. The object type is a <code>dfm</code> object from the <code>quanteda</code> package. In this analysis we generate the document frequency matrix at the comment level, but an alternative is to generate the matrix at the sentence level instead.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">comments_dfm &lt;-<span class="st"> </span>tidy_comments <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/join">inner_join</a></span>(common_words) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/tally">count</a></span>(ResponseID, word) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/arrange">arrange</a></span>(ResponseID) <span class="op">%&gt;%</span>
<span class="st">  </span>tidytext<span class="op">::</span><span class="kw">cast_dfm</span>(ResponseID, word, n) </code></pre></div>
</div>
<div id="make-a-metadata-dataframe" class="section level3">
<h3 class="hasAnchor">
<a href="#make-a-metadata-dataframe" class="anchor"></a>Make a metadata dataframe</h3>
<p>One of the interesting features of Structure Topic Models is that covariates can be included in the model directly. In this example we only include the ResponseID and original comment in the metadata data frame. Importantly the rownames of the metadata dataframe must be the document id (ie response id in this case).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">comments_dfm_meta &lt;-<span class="st"> </span>comments <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/filter">filter</a></span>(ResponseID <span class="op">%in%</span><span class="st"> </span><span class="kw">docnames</span>(comments_dfm)) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/arrange">arrange</a></span>(ResponseID) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>() 
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(comments_dfm_meta) &lt;-<span class="st"> </span>comments_dfm_meta<span class="op">$</span>ResponseID</code></pre></div>
</div>
<div id="make-an-stm-object" class="section level3">
<h3 class="hasAnchor">
<a href="#make-an-stm-object" class="anchor"></a>Make an stm object</h3>
<p>Create an stm Corpus object since some functions in <code>stm</code> require this rather than data frames.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">comments_stmc &lt;-<span class="st"> </span><span class="kw">asSTMCorpus</span>(comments_dfm, <span class="dt">data=</span>comments_dfm_meta)</code></pre></div>
</div>
</div>
<div id="topic-modelling" class="section level2">
<h2 class="hasAnchor">
<a href="#topic-modelling" class="anchor"></a>Topic Modelling</h2>
<div id="identify-optimal-value-of-k" class="section level3">
<h3 class="hasAnchor">
<a href="#identify-optimal-value-of-k" class="anchor"></a>Identify optimal value of K</h3>
<p>Here we fit the model with 16 topics, see the <code>stm::searchK</code> function for more information on optimising the number of clusters.</p>
</div>
<div id="fit-the-topic-model" class="section level3">
<h3 class="hasAnchor">
<a href="#fit-the-topic-model" class="anchor"></a>Fit the topic model</h3>
<p>Use the <code>stm</code> package to fit a topic model. We don’t include any covariates here, but these could be set with the <code>prevalence</code> parameter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">topic_model &lt;-<span class="st"> </span><span class="kw">stm</span>(comments_dfm, 
   <span class="dt">K=</span><span class="dv">16</span>, 
   <span class="dt">data=</span>comments_dfm_meta, 
   <span class="dt">max.em.its =</span> <span class="dv">20</span>,
   <span class="dt">verbose=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>Generate a summary of the topic model. For each topic, the top words according to four different metrics are generated. Top probability is just the most common words, the other metrics use different forms of weighting to pick up words that are more exclusive to the topic. See the stm vignette for more information on the metrics.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(topic_model)</code></pre></div>
</div>
</div>
<div id="preparing-topic-modelling-results-for-orgsurveyr" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-topic-modelling-results-for-orgsurveyr" class="anchor"></a>Preparing Topic Modelling Results For orgsurveyr</h2>
<div id="aims" class="section level3">
<h3 class="hasAnchor">
<a href="#aims" class="anchor"></a>Aims</h3>
<p>In topic modelling, we seek to assign topic proportions (gamma coefficients) to each document. To turn the topics into a metric that is associated with each individual, we therefore have to map the individual id to the topic id. In orgsurveyr parlance, each topic is a metric and the topic proportion for each individual is the value that we will seek to plot. What we are aiming to achieve is a data frame in the <code>indiv_tall_df</code> where each ‘metric’ is a topic, and each value is the gamma coefficient for that topic for a given individual:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tg_org_indiv_tall_df
<span class="co">#&gt; # A tibble: 292 x 3</span>
<span class="co">#&gt;    individual_id metric_id value</span>
<span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1             test_var   7.27</span>
<span class="co">#&gt;  2 2             test_var   8.53</span>
<span class="co">#&gt;  3 3             test_var   9.21</span>
<span class="co">#&gt;  4 4             test_var  12.9 </span>
<span class="co">#&gt;  5 5             test_var   5.02</span>
<span class="co">#&gt;  6 6             test_var  11.0 </span>
<span class="co">#&gt;  7 7             test_var   6.33</span>
<span class="co">#&gt;  8 8             test_var  13.8 </span>
<span class="co">#&gt;  9 9             test_var   7.48</span>
<span class="co">#&gt; 10 10            test_var  11.7 </span>
<span class="co">#&gt; # ... with 282 more rows</span></code></pre></div>
</div>
<div id="map-responses-to-dfm-document-id" class="section level3">
<h3 class="hasAnchor">
<a href="#map-responses-to-dfm-document-id" class="anchor"></a>Map responses to dfm document id</h3>
<p>When we created the document frequency object, the link between the original ResponseID and each piece of text is lost and is instead maintained through the row identifier. We therefore need to create a link between each document and each ResponseID:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stm_responses &lt;-<span class="st"> </span>comments_stmc<span class="op">$</span>data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span>tibble<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tibble/topics/rownames">rowid_to_column</a></span>(<span class="st">'document'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(document, ResponseID)</code></pre></div>
</div>
<div id="create-topic-labels" class="section level3">
<h3 class="hasAnchor">
<a href="#create-topic-labels" class="anchor"></a>Create topic labels</h3>
<p>Similarly to the individual id, each topic is identified by a numeric id. We can create labels for these using the <code>labelTopics</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stm_labels &lt;-<span class="st"> </span><span class="kw">labelTopics</span>(topic_model, <span class="dt">n=</span><span class="dv">3</span>)<span class="op">$</span>frex <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span>tibble<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tibble/topics/rownames">rowid_to_column</a></span>(<span class="st">'topic'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(topic, <span class="dt">topic_name=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">'t'</span>, topic, V1, V2, V3, <span class="dt">sep=</span><span class="st">'_'</span>))
stm_labels</code></pre></div>
<p>Note that there are limitations around the format of the topic names, ie don’t include special characters or include numbers at the start of the topic. This issue will be resolved in future versions of orgsurveyr (0.6.0 at time of writing).</p>
</div>
<div id="extract-the-topic-proportions-from-the-topic-model" class="section level3">
<h3 class="hasAnchor">
<a href="#extract-the-topic-proportions-from-the-topic-model" class="anchor"></a>Extract the topic proportions from the topic model</h3>
<p>The <code>tidytext</code> package includes a <code>tidy</code> function which can extract components of the topic model object from the <code>stm</code> package (see <code>?tidytext::stm_tidiers</code>). For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidytext<span class="op">::</span><span class="kw">tidy</span>(topic_model, <span class="dt">matrix=</span><span class="st">'gamma'</span>)</code></pre></div>
<p>For each document, the topic proportion for each topic is returned. We can join the document and topic identifiers with the data frames we generated earlier with topic labels and individual identifiers to give us a data frame in the <code>indiv_tall_df</code> format of <code>orgsurveyr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stm_metrics &lt;-<span class="st"> </span><span class="kw">tidy</span>(topic_model, <span class="dt">matrix=</span><span class="st">'gamma'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(stm_responses, <span class="dt">by=</span><span class="st">'document'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(stm_labels, <span class="dt">by=</span><span class="st">'topic'</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">individual_id=</span>ResponseID, <span class="dt">metric_id=</span>topic_name, <span class="dt">value=</span>gamma)</code></pre></div>
<p>Double check that the data frame is in the correct format:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/get_df_format.html">get_df_format</a></span>(stm_metrics)</code></pre></div>
</div>
</div>
<div id="analysis-with-orgsurveyr" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-with-orgsurveyr" class="anchor"></a>Analysis with <code>orgsurveyr</code>
</h2>
<p>Once the data frame in <code>indiv_tall_df</code> format is created, it can be analysed in <code>orgsurveyr</code> using the approaches described in this and other vignettes. Usefully, the data frame from the survey data and NLP data can be combined using the <code><a href="https://www.rdocumentation.org/packages/dplyr/topics/bind">dplyr::bind_rows</a></code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">combined_df &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/dplyr/topics/bind">bind_rows</a></span>(df_metrics, stm_metrics)</code></pre></div>
</div>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h1>
<p>This vignette contains example code for transforming Civil Service People Survey numerical and text data into the data formats required by <code>orgsurveyr</code>. This is accomplished using a relatively standard tidyverse workflow. Note that this does not represent the only way in which this data reformatting could be done, data could be transformed with other packages or even outside of R entirely, the <code>orgsurveyr</code> package’s requirements are just that the data is formated in a particular way, how this is done is left open to the user.</p>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/sessionInfo">sessionInfo</a></span>()
<span class="co">#&gt; R version 3.5.1 (2018-07-02)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Debian GNU/Linux 9 (stretch)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS: /usr/lib/openblas-base/libblas.so.3</span>
<span class="co">#&gt; LAPACK: /usr/lib/libopenblasp-r0.2.19.so</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span>
<span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span>
<span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             </span>
<span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span>
<span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] orgsurveyr_0.6.0 ggplot2_3.0.0    dplyr_0.7.6     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] tidyselect_0.2.4   purrr_0.2.5        colorspace_1.3-2  </span>
<span class="co">#&gt;  [4] htmltools_0.3.6    viridisLite_0.3.0  yaml_2.2.0        </span>
<span class="co">#&gt;  [7] utf8_1.1.4         rlang_0.2.2        pkgdown_1.2.0.9000</span>
<span class="co">#&gt; [10] pillar_1.3.0       later_0.7.5        glue_1.3.0        </span>
<span class="co">#&gt; [13] withr_2.1.2        tweenr_1.0.0       bindrcpp_0.2.2    </span>
<span class="co">#&gt; [16] bindr_0.1.1        plyr_1.8.4         stringr_1.3.1     </span>
<span class="co">#&gt; [19] munsell_0.5.0      commonmark_1.5     gtable_0.2.0      </span>
<span class="co">#&gt; [22] memoise_1.1.0      evaluate_0.11      knitr_1.20        </span>
<span class="co">#&gt; [25] httpuv_1.4.5       fansi_0.3.0        Rcpp_0.12.18      </span>
<span class="co">#&gt; [28] xtable_1.8-3       scales_1.0.0       backports_1.1.2   </span>
<span class="co">#&gt; [31] promises_1.0.1     desc_1.2.0         mime_0.5          </span>
<span class="co">#&gt; [34] farver_1.0         fs_1.2.6           gridExtra_2.3     </span>
<span class="co">#&gt; [37] ggforce_0.1.3      digest_0.6.17      stringi_1.2.4     </span>
<span class="co">#&gt; [40] ggrepel_0.8.0      shiny_1.1.0        grid_3.5.1        </span>
<span class="co">#&gt; [43] rprojroot_1.3-2    cli_1.0.1          tools_3.5.1       </span>
<span class="co">#&gt; [46] magrittr_1.5       lazyeval_0.2.1     tibble_1.4.2      </span>
<span class="co">#&gt; [49] ggraph_1.0.2       crayon_1.3.4       pkgconfig_2.0.2   </span>
<span class="co">#&gt; [52] MASS_7.3-50        xml2_1.2.0         assertthat_0.2.0  </span>
<span class="co">#&gt; [55] rmarkdown_1.10     roxygen2_6.1.0     rstudioapi_0.7    </span>
<span class="co">#&gt; [58] viridis_0.5.1      R6_2.2.2           units_0.6-1       </span>
<span class="co">#&gt; [61] igraph_1.2.2       compiler_3.5.1</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#loading-the-data">Loading the data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#raw-data-files">Raw data files</a></li>
      <li><a href="#data-import">Data import</a></li>
      <li><a href="#data-cleaning">Data cleaning</a></li>
      </ul>
</li>
      <li>
<a href="#data-preparation">Data preparation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#introduction-1">Introduction</a></li>
      <li><a href="#individual-responses-data">Individual responses data</a></li>
      <li><a href="#mapping-individual-to-organisational-unit">Mapping individual to organisational unit</a></li>
      <li><a href="#organisational-structure">Organisational structure</a></li>
      </ul>
</li>
      <li>
<a href="#data-exploration-with-orgsurveyr">Data Exploration With orgsurveyr</a><ul class="nav nav-pills nav-stacked">
<li><a href="#generate-summary-data">Generate summary data</a></li>
      <li><a href="#explore-summary-data">Explore summary data</a></li>
      <li><a href="#visualise-summary-scores">Visualise summary scores</a></li>
      <li><a href="#interactive-visualisation-of-summary-scores">Interactive visualisation of summary scores</a></li>
      </ul>
</li>
      <li>
<a href="#natural-language-processing">Natural Language Processing</a><ul class="nav nav-pills nav-stacked">
<li><a href="#introduction-2">Introduction</a></li>
      <li><a href="#prepare-data-for-nlp">Prepare data for NLP</a></li>
      <li><a href="#topic-modelling">Topic Modelling</a></li>
      <li><a href="#preparing-topic-modelling-results-for-orgsurveyr">Preparing Topic Modelling Results For orgsurveyr</a></li>
      <li><a href="#analysis-with-orgsurveyr">Analysis with <code>orgsurveyr</code></a></li>
      </ul>
</li>
      <li><a href="#conclusion">Conclusion</a></li>
      <li><a href="#session-info">Session Info</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Phil Chapman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
